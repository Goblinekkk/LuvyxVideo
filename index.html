<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luvyx Video 2.0</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: #000; color: white; margin: 0; padding-bottom: 80px; 
        }
        
        header { 
            padding: 20px; text-align: center; font-size: 1.4rem; font-weight: 900; 
            border-bottom: 1px solid #1a1a1a; background: #000; 
            position: sticky; top: 0; z-index: 100; color: #ff4500;
        }

        .page { display: none; padding: 10px; animation: fadeIn 0.3s; }
        .active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .video-card { background: #000; margin-bottom: 25px; border-radius: 12px; overflow: hidden; }
        .video-wrapper { position: relative; width: 100%; padding-top: 56.25%; background: #111; }
        /* Speci√°ln√≠ √∫prava pro Shorts na v√Ω≈°ku */
        .is-shorts { padding-top: 177%; width: 70%; margin: 0 auto; }
        
        iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        
        .v-info { padding: 12px 5px; }
        .v-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 4px; }
        .v-author { font-size: 0.85rem; color: #ff4500; font-weight: bold; text-transform: uppercase; }

        nav { 
            position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95); 
            display: flex; justify-content: space-around; padding: 15px 0; 
            border-top: 1px solid #222; backdrop-filter: blur(10px);
        }

        nav button { background: none; border: none; color: #555; font-size: 0.75rem; font-weight: bold; cursor: pointer; }
        nav button.active-btn { color: #fff; }
        nav button.active-btn::after { content: ''; display: block; width: 6px; height: 6px; background: #ff4500; border-radius: 50%; margin: 5px auto 0; }

        .upload-section { background: #111; padding: 20px; border-radius: 15px; border: 1px solid #222; }
        input { 
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; 
            border: 1px solid #333; background: #000; color: white; box-sizing: border-box; 
        }

        .btn-publish { 
            background: linear-gradient(45deg, #ff4500, #ff8c00); 
            color: #fff; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: 800; cursor: pointer;
        }

        #login-screen { text-align: center; padding: 50px 20px; }
    </style>
</head>
<body>

<header id="app-bar">LUVYX VIDEO</header>

<div id="home" class="page active">
    <div id="videoContainer">
        <p style="text-align:center; color:#555;">Naƒç√≠t√°m tv≈Øj svƒõt... üî•</p>
    </div>
</div>

<div id="mychannel" class="page">
    <div id="auth-container">
        </div>
    
    <div id="myVideosListContainer" style="margin-top:20px;"></div>
</div>

<nav>
    <button id="nav-home" class="active-btn" onclick="navigateTo('home')">Home</button>
    <button id="nav-channel" onclick="navigateTo('mychannel')">Channel</button>
</nav>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwds11bGYMa6wZMYwOv7Q477rbdT7JfeF3RkSbMhP7Bb9Tg8KcGILen-ehTpBOTXrBB/exec";
    
    // Naƒçten√≠ jm√©na z pamƒõti telefonu
    let currentUser = localStorage.getItem('luvyx_user');

    function navigateTo(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.getElementById('nav-home').classList.toggle('active-btn', pageId === 'home');
        document.getElementById('nav-channel').classList.toggle('active-btn', pageId === 'mychannel');
        
        if (pageId === 'home') fetchVideos();
        if (pageId === 'mychannel') checkAuth();
    }

    // --- P≈òIHL√Å≈†EN√ç (Ukl√°d√° se do prohl√≠≈æeƒçe) ---
    function checkAuth() {
        const container = document.getElementById('auth-container');
        if (!currentUser) {
            container.innerHTML = `
                <div id="login-screen">
                    <h2>V√≠tej v Luvyx! üî•</h2>
                    <p style="color:#888;">Vyber si jm√©no pro sv≈Øj kan√°l:</p>
                    <input type="text" id="userNameInput" placeholder="Tvoje jm√©no...">
                    <button class="btn-publish" onclick="saveUser()">VYTVO≈òIT KAN√ÅL</button>
                </div>`;
        } else {
            container.innerHTML = `
                <div class="upload-section">
                    <p style="margin:0 0 10px 0; color:#ff4500; font-weight:bold;">Kan√°l: ${currentUser}</p>
                    <input type="text" id="vidName" placeholder="N√°zev videa...">
                    <input type="text" id="vidUrl" placeholder="YouTube odkaz nebo Shorts...">
                    <button class="btn-publish" onclick="handleUpload()">PUBLIKOVAT</button>
                    <button onclick="logout()" style="background:none; border:none; color:#444; margin-top:15px; width:100%; font-size:0.7rem;">ODHL√ÅSIT SE</button>
                </div>`;
        }
    }

    function saveUser() {
        const name = document.getElementById('userNameInput').value;
        if (name.length < 2) return alert("Jm√©no je moc kr√°tk√©!");
        localStorage.setItem('luvyx_user', name);
        currentUser = name;
        checkAuth();
    }

    function logout() {
        if(confirm("Opravdu se chce≈° odhl√°sit?")) {
            localStorage.removeItem('luvyx_user');
            currentUser = null;
            checkAuth();
        }
    }

    // --- NAƒå√çT√ÅN√ç VIDE√ç ---
    async function fetchVideos() {
        const container = document.getElementById('videoContainer');
        try {
            const response = await fetch(SCRIPT_URL);
            const data = await response.json();
            
            container.innerHTML = data.slice().reverse().map(v => {
                const vidId = extractYouTubeId(v[1]);
                const isShorts = v[1].includes('/shorts/');
                const author = v[2] || "Nezn√°m√Ω"; // Sloupec C

                return `
                    <div class="video-card">
                        <div class="video-wrapper ${isShorts ? 'is-shorts' : ''}">
                            <iframe src="https://www.youtube.com/embed/${vidId}" allowfullscreen></iframe>
                        </div>
                        <div class="v-info">
                            <div class="v-title">${v[0]}</div>
                            <div class="v-author">@${author}</div>
                        </div>
                    </div>
                `;
            }).join('');
        } catch (e) {
            container.innerHTML = '<p style="text-align:center;">Chyba p≈ôi naƒç√≠t√°n√≠ dat.</p>';
        }
    }

    // --- PUBLIKOV√ÅN√ç ---
    async function handleUpload() {
        const title = document.getElementById('vidName').value;
        const url = document.getElementById('vidUrl').value;
        if (!title || !url) return alert("Vypl≈à v≈°e!");

        const btn = document.querySelector('.btn-publish');
        btn.innerText = "PUBLIKUJI...";
        btn.disabled = true;

        try {
            await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify({ 
                    title: title, 
                    url: url, 
                    author: currentUser // Pos√≠l√°me jm√©no do sloupce C
                })
            });
            navigateTo('home');
        } catch (e) {
            alert("Chyba p≈ôi odes√≠l√°n√≠.");
        } finally {
            btn.innerText = "PUBLIKOVAT";
            btn.disabled = false;
        }
    }

    function extractYouTubeId(url) {
        const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=|shorts\/)|youtu\.be\/)([^"&?\/\s]{11})/;
        const match = url.match(regex);
        return match ? match[1] : null;
    }

    fetchVideos();
</script>

</body>
</html>
